---
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';

import Default from '@/layouts/Default.astro';
import FormattedDate from '@/components/FormattedDate.astro';
import { PAGES_METADATA } from '@/consts';

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.date.valueOf() - a.data.date.valueOf(),
);
const tagCounts = new Map<string, number>();
posts.forEach((post) => {
	post.data.tags.forEach((tag) => {
		tagCounts.set(tag, (tagCounts.get(tag) || 0) + 1);
	});
});
const sortedTags = Array.from(tagCounts.entries()).sort(([a], [b]) => a.localeCompare(b));

const { title, description } = PAGES_METADATA.blog;
---

<Default title={title} description={description}>
	<section class="blog">
		<h1>{title}</h1>
		<div class="posts-list">
			{
				posts.map((post) => {
					const { image, alt } = post.data.imageData;
					return (
						<article class="post">
							<a class="post-link" href={`/blog/${post.id}`}>
								<Image class="post-image" src={image} alt={`Post cover: ${alt}`} />
								<div class="post-details">
									<h2 class="post-heading">{post.data.title}</h2>
									<FormattedDate date={post.data.date} />
								</div>
							</a>
						</article>
					);
				})
			}
		</div>
	</section>
</Default>

<style>
	.posts-list {
		display: flex;
		flex-wrap: wrap;
		gap: 2rem;
		margin: 2rem 0;
	}

	.post:first-child {
		flex-basis: 100%;
	}

	.post {
		flex-basis: calc(50% - 1rem);
	}

	.post-link {
		text-decoration: none;
		display: flex;
		flex-direction: column;
		gap: 1rem;
	}

	.post-image {
		aspect-ratio: 16 / 9;
	}

	.post-details {
		font-family: var(--font-family-sans-serif-condensed);
	}

	.post-heading {
		margin: 0;
		font-size: var(--font-size-heading-3);
	}

	@media only screen and (max-width: 500px) {
		.posts-list {
			flex-direction: column;
		}
		.post {
			flex-basis: 100%;
		}
	}
</style>

<!-- <div class="pagination">
	<div class="pagination__side">
		{% if paginator.previous_page %}
		<a class="pagination__link" href="/" aria-label="First page">
			&#8676; First
		</a>
		<a
			class="pagination__link"
			href="{{ paginator.previous_page_path }}"
			aria-label="Previous page"
		>
			&#8592; Previous
		</a>
		{% else %}
		<div class="pagination__link_disabled" aria-hidden="true">
			&#8676; First
		</div>
		<div class="pagination__link_disabled" aria-hidden="true">
			&#8592; Previous
		</div>
		{% endif %}
	</div>
	<div class="pagination__side pagination__side_middle">
		<span class="pagination__page-number">
			Page: {{ paginator.page }} of {{ paginator.total_pages }}
		</span>
	</div>
	<div class="pagination__side">
		{% if paginator.next_page %}
		<a
			class="pagination__link"
			href="{{ paginator.next_page_path }}"
			aria-label="Next page"
		>
			Next &#8594;
		</a>
		<a
			class="pagination__link"
			href="/page/{{ paginator.total_pages }}"
			aria-label="Last page"
		>
			Last &#8677;
		</a>
		{% else %}
		<div class="pagination__link_disabled" aria-hidden="true">
			Next &#8594;
		</div>
		<div class="pagination__link_disabled" aria-hidden="true">
			Last &#8677;
		</div>
		{% endif %}
	</div>
</div> -->

<!-- .blog {
  flex: 1;
  display: flex;
  flex-direction: column;

  &__heading {
  }

  &__total-posts {
    display: inline-block;
    margin-top: 0.5rem;
    margin-left: 0.1rem;

    vertical-align: top;
    font-weight: normal;
    font-size: $font-size-default;

    &_hidden {
      position: absolute;
      overflow: hidden;

      width: 1px;
      height: 1px;

      opacity: 0;
    }
  }

  &__post-list {
    flex: 1;

    .post {
      margin-bottom: 2rem;

      @media only screen and (max-width: 460px) {
        margin-bottom: 4rem;

        &:last-child {
          margin-bottom: 2rem;
        }
      }

      &__link {
        display: flex;

        text-decoration: none;

        &:hover {
          color: $color-black;

          .post__heading {
            color: $color-primary;
          }
        }

        &:active {
          color: $color-black;

          .post__heading {
            color: $color-primary-dark;
          }
        }

        @media only screen and (max-width: 460px) {
          flex-direction: column;
        }
      }

      &__image-container {
        margin-right: 1rem;
        width: 12rem;
        height: 12rem;

        aspect-ratio: 1 / 1;

        @media only screen and (max-width: 460px) {
          margin-right: 0;
          margin-bottom: 1rem;
          width: 100%;
          height: 100%;

          aspect-ratio: 16 / 9;
        }
      }

      &__image {
        display: block;
        width: 100%;
        height: 100%;

        object-fit: cover;
        object-position: center;
      }

      &__details {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }

      &__heading {
        font-family: $font-family-sans-serif-condensed;
      }

      &__date {
        display: block;
        margin: 1rem 0;

        font-family: $font-family-sans-serif-condensed;
        color: $color-gray;
        font-size: $font-size-medium;

        @media only screen and (max-width: 460px) {
          margin: 0.5rem 0;
        }
      }

      &__excerpt {
        margin: 0;

        display: -webkit-box;
        line-clamp: 2;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
        font-family: $font-family-sans-serif;
      }
    }
  }
} -->
